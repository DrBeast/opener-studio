async function testRateLimit() {
  const functionUrl =
    "https://exbzektbhynykyschqso.supabase.co/functions/v1/generate_message";
  const authToken =
    "eyJhbGciOiJIUzI1NiIsImtpZCI6Imk3aTdWWDhWOFoxbDlpbGMiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2V4Ynpla3RiaHlueWt5c2NocXNvLnN1cGFiYXNlLmNvL2F1dGgvdjEiLCJzdWIiOiI1ZTQ1NzZhNy1mMjVjLTQ2NjQtODQxNS02YjAyYjQwOWYyMzYiLCJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNzYxNjkxMTAyLCJpYXQiOjE3NjE2ODc1MDIsImVtYWlsIjoiYWxla3NhbmRyLnJha2l0aW5AZ21haWwuY29tIiwicGhvbmUiOiIiLCJhcHBfbWV0YWRhdGEiOnsicHJvdmlkZXIiOiJlbWFpbCIsInByb3ZpZGVycyI6WyJlbWFpbCIsImdvb2dsZSJdfSwidXNlcl9tZXRhZGF0YSI6eyJhdmF0YXJfdXJsIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EvQUNnOG9jS0IzeTQ0cnVGZ2dkSXJ0RENhSk9ZajdUWWFnVHVXOV9uMElLenRqQUlfR0pMY3VIUTR5UT1zOTYtYyIsImVtYWlsIjoiYWxla3NhbmRyLnJha2l0aW5AZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZ1bGxfbmFtZSI6IkFsZWtzYW5kciBSYWtpdGluIiwiaXNzIjoiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tIiwibmFtZSI6IkFsZWtzYW5kciBSYWtpdGluIiwicGhvbmVfdmVyaWZpZWQiOmZhbHNlLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EvQUNnOG9jS0IzeTQ0cnVGZ2dkSXJ0RENhSk9ZajdUWWFnVHVXOV9uMElLenRqQUlfR0pMY3VIUTR5UT1zOTYtYyIsInByb3ZpZGVyX2lkIjoiMTAzOTkzNDgwNTIzOTc3MjQ3NDc3Iiwic3ViIjoiMTAzOTkzNDgwNTIzOTc3MjQ3NDc3In0sInJvbGUiOiJhdXRoZW50aWNhdGVkIiwiYWFsIjoiYWFsMSIsImFtciI6W3sibWV0aG9kIjoib2F1dGgiLCJ0aW1lc3RhbXAiOjE3NjE2ODc1MDJ9XSwic2Vzc2lvbl9pZCI6ImM1NjgzMWI2LWQ0NTQtNGUzYy04OGY3LTNmMWU1OTljNTU1OSIsImlzX2Fub255bW91cyI6ZmFsc2V9.JiFT3yNGFSnwNGFZTxJD1mKPosfzhPuROHtzBqQLgMk";

  const bodyObject = {
    contact_id: "93877c7f-c42b-4772-8f79-d7a198523c95", // Replace with a valid ID if needed for testing
    medium: "LinkedIn connection note", // Or another valid medium ID
    objective: "Request an informational interview", // Or another valid objective
    additional_context: "Testing rate limit function.", // Optional context
    is_guest: false,
    user_profile_id: "4ff97ca4-9a56-4f5a-bc24-2ea8bf5bc49d",
  };

  const requestBody = JSON.stringify(bodyObject);
  const numRequests = 15; // Number of requests to send
  const delayMs = 2000; // Small delay between requests (optional)

  console.log(`Sending ${numRequests} requests...`);
  let rateLimitedCount = 0;

  for (let i = 0; i < numRequests; i++) {
    try {
      const response = await fetch(functionUrl, {
        method: "POST", // Or 'GET', etc.
        headers: {
          Authorization: `Bearer ${authToken}`,
          "Content-Type": "application/json",
          apikey:
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4Ynpla3RiaHlueWt5c2NocXNvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg1Mzk2NDksImV4cCI6MjA2NDExNTY0OX0.yN9C7USIeelvdfTs_sBq9zwxWOb8JOzdPLwxrPU9s3c",
        },
        body: requestBody,
      });

      console.log(`Request ${i + 1}: Status ${response.status}`);
      if (response.status === 429) {
        // 429 is the standard "Too Many Requests" code
        rateLimitedCount++;
      }
      // Optional small delay
      if (delayMs > 0) {
        await new Promise((resolve) => setTimeout(resolve, delayMs));
      }
    } catch (error) {
      console.error(`Request ${i + 1} failed:`, error);
    }
  }
  console.log(
    `Finished. ${rateLimitedCount} requests were rate limited (Status 429).`
  );
}

testRateLimit();
